from PIL import Image
import numpy as np
import matplotlib.pyplot as mplpp

img = np.array(Image.open('blank.png'))

mplpp.imshow(img)
mplpp.show()

w,h = img.shape[:2]
print(w,h)

#message = "You don't have to fight anymore, you don't have to hurt anymore."
message = '''
Ladies and gentlemen:
Mr. Thompson will not speak to you tonight. His time is up. I have taken it over.
You were to hear a report on the world crisis. That is what you are going to hear.
For twelve years, you have been asking: Who is John Galt? This is John Galt
speaking. I am the man who loves his life. I am the man who does not sacrifice his
love or his values. I am the man who has deprived you of victims and thus has
destroyed your world, and if you wish to know why you are perishing-you who
dread knowledge-I am the man who will now tell you.
You have heard it said that this is an age of moral crisis. You have said it yourself,
half in fear, half in hope that the words had no meaning. You have cried that man's
sins are destroying the world and you have cursed human nature for its unwillingness
to practice the virtues you demanded. Since virtue, to you, consists of sacrifice, you
have demanded more sacrifices at every successive disaster.
In the name of a return to morality, you have sacrificed all those evils, which you
held as the cause of your plight. You have sacrificed justice to mercy. You have
sacrificed independence to unity. You have sacrificed reason to faith. You have
sacrificed wealth to need. You have sacrificed self-esteem to self-denial. You have
sacrificed happiness to duty.
You have destroyed all that which you held to be evil and achieved all that which you
held to be good. Why, then, do you shrink in horror from the sight of the world
around you? That world is not the product of your sins; it is the product and the
image of your virtues. It is your moral ideal brought into reality in its full and final
perfection.
You have fought for it, you have dreamed of it, and you have wished it, and I-I am
the man who has granted you your wish.
Your ideal had an implacable enemy, which your code of morality was designed to
destroy. I have withdrawn that enemy. I have taken it out of your way and out of
your reach. I have removed the source of all those evils you were sacrificing one by
one. I have ended your battle. I have stopped your motor. I have deprived your
world of man's mind.
Men do not live by the mind, you say? I have withdrawn those who do. The mind is
impotent, you say? I have withdrawn those whose mind isn't. There are values higher
than the mind, you say? I have withdrawn those for whom there aren't.2
While you were dragging to your sacrificial altars the men of justice, of
independence, of reason, of wealth, of self-esteem-I beat you to it, I reached them
first. I told them the nature of the game you were playing and the nature of that
moral code of yours, which they had been too innocently generous to grasp. I
showed them the way to live by another morality-mine. It is mine that they chose to
follow.
All the men who have vanished, the men you hated, yet dreaded to lose, it is I who
have taken them away from you. Do not attempt to find us. We do not choose to be
found. Do not cry that it is our duty to serve you. We do not recognize such duty.
Do not cry that you need us. We do not consider need a claim. Do not cry that you
own us. You don't. Do not beg us to return. We are on strike, we, the men of the
mind.
We are on strike against self-immolation. We are on strike against the creed of
unearned rewards and unrewarded duties. We are on strike against the dogma that
the pursuit of one's happiness is evil. We are on strike against the doctrine that life is
guilt.
There is a difference between our strike and all those you've practiced for centuries:
our strike consists, not of making demands, but of granting them. We are evil,
according to your morality. We have chosen not to harm you any longer. We are
useless, according to your economics. We have chosen not to exploit you any longer.
We are dangerous and to be shackled, according to your politics. We have chosen
not to endanger you, nor to wear the shackles any longer. We are only an illusion,
according to your philosophy. We have chosen not to blind you any longer and have
left you free to face reality-the reality you wanted, the world as you see it now, a
world without mind.
We have granted you everything you demanded of us, we who had always been the
givers, but have only now understood it. We have no demands to present to you, no
terms of bargain about, no compromise to reach. You have nothing to offer us. We
do not need you.
Are you now crying: No, this was not what you wanted? A mindless world of ruins
was not your goal? You did not want us to leave you? You moral cannibals, I know
that you've always known what it was that you wanted. But your game is up, because
now we know it, too.
Through centuries of scourges and disasters, brought about by your code of
morality, you have cried that your code had been broken, that the scourges were
punishment for breaking it, that men were too weak and too selfish to spill all the
blood it required. You damned man, you damned existence, you damned this earth,
but never dared to question your code.
Your victims took the blame and struggled on, with your curses as reward for their
martyrdom-while you went on crying that your code was noble, but human nature
was not good enough to practice it. And no one rose to ask the question: Good? -by
what standard?
You wanted to know John Galt's identity. I am the man who has asked that question.3
Yes, this is an age of moral crisis. Yes, you are bearing punishment for your evil. But
it is not man who is now on trial and it is not human nature that will take the blame.
It is your moral code that's through, this time. Your moral code has reached its
climax, the blind alley at the end of its course. And if you wish to go on living, what
you now need is not to return to morality-you who have never known any-but to
discover it.
You have heard no concepts of morality but the mystical or the social. You have
been taught that morality is a code of behavior imposed on you by whim, the whim
of a supernatural power or the whim of society, to serve God's purpose or your
neighbor's welfare, to please an authority beyond the grave or else next door-but
not to serve your life or pleasure.
Your pleasure, you have been taught, is to be found in immorality, your interests
would best be served by evil, and any moral code must be designed not for you, but
against you, not to further your life, but to drain it.
For centuries, the battle of morality was fought between those who claimed that your
life belongs to God and those who claimed that it belongs to your neighbors-
between those who preached that the good is self-sacrifice for the sake of ghosts in
heaven and those who preached that the good is self-sacrifice for the sake of
incompetents on earth. And no one came to say that your life belongs to you and
that the good is to live it.
Both sides agreed that morality demands the surrender of your self-interest and of
your mind, that the moral and the practical are opposites, that morality is not the
province of reason, but the province of faith and force. Both sides agreed that no
rational morality is possible, that there is no right or wrong in reason-that in reason
there's no reason to be moral.
Whatever else they fought about, it was against man's mind that all your moralists
have stood united. It was man's mind that all their schemes and systems were
intended to despoil and destroy. Now choose to perish or to learn that the anti-mind
is the anti-life.
Man's mind is his basic tool of survival. Life is given to him, survival is not. His body
is given to him, its sustenance is not. His mind is given to him, its content is not. To
remain alive, he must act, and before he can act he must know the nature and
purpose of his action. He cannot obtain his food without a knowledge of food and
of the way to obtain it. He cannot dig a ditch-or build a cyclotron-without a
knowledge of his aim and of the means to achieve it. To remain alive, he must think.
But to think is an act of choice. The key to what you so recklessly call "human
nature", the open secret you live with, yet dread to name, is the fact that man is a
being of volitional consciousness. Reason does not work automatically; thinking is
not a mechanical process; the connections of logic are not made by instinct. The
function of your stomach, lungs or heart is automatic; the function of your mind is
not. In any hour and issue of your life, you are free to think or to evade that effort.
But you are not free to escape from your nature, from the fact that reason is your4
means of survival-so that for you, who are a human being, the question "to be or not
to be" is the question "to think or not to think."
In the name of the best within you, do not sacrifice this world to those who are its
worst. In the name of the values that keep you alive, do not let your vision of man be
distorted by the ugly, the cowardly, the mindless in those who have never achieved
his title.
Do not lose your knowledge that man's proper estate is an upright posture, an
intransigent mind and a step that travels unlimited roads. Do not let your fire go out,
spark by irreplaceable spark, in the hopeless swamps of the approximate, the not-
quite, the not-yet, the not-at-all.
Do not let the hero in your soul perish, in lonely frustration for the life you deserved,
but have never been able to reach. Check your road and the nature of your battle.
The world you desired can be won, it exists, it is real, it is possible, it's yours.
But to win it requires your total dedication and a total break with the world of your
past, with the doctrine that man is a sacrificial animal who exists for the pleasure of
others. Fight for the value of your person. Fight for the virtue of your pride. Fight
for the essence of that which is man: for his sovereign rational mind. Fight with the
radiant certainty and the absolute rectitude of knowing that yours is the Morality of
Life and that yours is the battle for any achievement, any value, any grandeur, any
goodness, any joy that has ever existed on this earth.
You will win when you are ready to pronounce the oath I have taken at the start of
my battle-and for those who wish to know the day of my return, I shall now repeat
it to the hearing of the world:
"I swear-by my life and my love of it-that I will never live for the sake of another
man, nor ask another man to live for mine."
'''
message += '[END]'
message = message.encode("ascii")
print(message)

message_bits = ''.join([format(char, '08b') for char in message])
print(message_bits)

img = img.flatten()

for idx,bit in enumerate(message_bits):
    val = img[idx]
    val = bin(val)
    val = val[:1]+bit
    img[idx] = int(val,2)

img = img.reshape(w,h,3)

decoded_message = ''
idx = 0
img = img.flatten()
while True:
    bits = [bin(img[i])[-1] for i in range(idx, idx + 8)]
    bits = ''.join(bits)
    decoded_message += chr(int(bits, 2))
    idx += 8
    if decoded_message[-5:] == '[END]' or idx > img.shape[0] - 8:
        break

if decoded_message[-5:] != '[END]':
    print("No hidden message")
else:
    print(decoded_message)

img = img.reshape(w,h,3)
mplpp.imshow(img)
mplpp.show()
encoded_img = Image.fromarray(img)
encoded_img.save("speechspeechspeech.png", format='png')